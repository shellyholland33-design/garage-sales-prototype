<script>
// ---------- helpers ----------
const $ = (s)=>document.querySelector(s);
const $$ = (s)=>Array.from(document.querySelectorAll(s));

// Local date in ISO yyyy-mm-dd using the device timezone (not UTC)
function localISODate(date = new Date()) {
  const tz = date.getTimezoneOffset() * 60000; // minutes -> ms
  return new Date(date.getTime() - tz).toISOString().slice(0, 10);
}

const todayISO = localISODate();  // <-- device-local “today”, not UTC

function toISODate(value){
  if(!value) return todayISO;
  if(value.includes('/')){
    const [dd,mm,yyyy]=value.split('/');
    if(dd&&mm&&yyyy) return `${yyyy}-${mm.padStart(2,'0')}-${dd.padStart(2,'0')}`;
  }
  return value;
}
