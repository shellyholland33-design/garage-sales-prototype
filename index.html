<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Garage Sales â€“ Prototype with Map & Status</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<style>
  :root { --bg:#f7f7f8; --card:#ffffff; --ink:#111827; --muted:#6b7280; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  header{background:#fff;border-bottom:1px solid #e5e7eb}
  .wrap{max-width:1120px;margin:0 auto;padding:16px}
  h1{margin:0;font-size:20px}
  nav button{padding:8px 14px;border:0;border-radius:999px;background:#e5e7eb;cursor:pointer}
  nav button.active{background:#111827;color:#fff}
  .card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,.06);margin-top:12px}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:4px}
  input[type="text"],input[type="date"],input[type="time"]{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .chip{background:#e5e7eb;border-radius:999px;padding:6px 10px;font-size:12px;cursor:pointer}
  .btn{padding:10px 12px;border-radius:12px;border:0;cursor:pointer;font-size:14px}
  .btn.primary{background:#111827;color:#fff}
  .btn.alt{background:#e5e7eb}
  .btn.link{background:transparent;text-decoration:underline}
  .muted{color:var(--muted);font-size:14px}
  .list{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
  @media (max-width:900px){.list{grid-template-columns:1fr}}
  .tags span{background:#f3f4f6;border-radius:999px;padding:4px 8px;font-size:12px;margin-right:6px}
  .pill{padding:6px 10px;border-radius:999px;background:#f3f4f6;font-size:12px}
  .warn{color:#b91c1c;font-size:12px}
  #map{height:520px;border-radius:16px;overflow:hidden}
  .legend{display:flex;gap:10px;align-items:center;margin-top:8px}
  .dot{width:12px;height:12px;border-radius:50%}
  footer{color:var(--muted);text-align:center;padding:24px}
</style>
</head>
<body>
<header>
  <div class="wrap row" style="align-items:center;justify-content:space-between">
    <h1>Garage Sales</h1>
    <nav class="row">
      <button id="tab-search" class="active">Search</button>
      <button id="tab-map">Map</button>
      <button id="tab-planner">Planner</button>
      <button id="tab-favs">Favourites</button>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- Filters -->
  <section class="card" id="filters">
    <div class="grid">
      <div>
        <label>Date</label>
        <input type="date" id="f-date" />
      </div>
      <div>
        <label>Town, city or postcode</label>
        <input type="text" id="f-location" placeholder="Toowoomba or 4350" />
      </div>
      <div>
        <label>Item</label>
        <input type="text" id="f-item" placeholder="bike, pram, tools" />
      </div>
      <div class="row" style="align-items:flex-end">
        <span class="chip" data-quick="bike">bike</span>
        <span class="chip" data-quick="tools">tools</span>
        <span class="chip" data-quick="furniture">furniture</span>
        <span class="chip" data-quick="baby">baby</span>
        <span class="chip" data-quick="retro">retro</span>
      </div>
    </div>
  </section>

  <!-- Search -->
  <section id="search-view">
    <div id="results" class="list"></div>
  </section>

  <!-- Map -->
  <section id="map-view" style="display:none">
    <div class="card">
      <div class="row" style="align-items:center;justify-content:space-between;margin-bottom:8px">
        <div class="row" style="gap:12px">
          <label style="display:flex;align-items:center;gap:6px">
            <input type="checkbox" id="toggle-all" checked /> Show all (filtered)
          </label>
          <label style="display:flex;align-items:center;gap:6px">
            <input type="checkbox" id="toggle-chosen" checked /> Show today's chosen
          </label>
        </div>
        <div class="legend">
          <span class="dot" style="background:#2563eb"></span><span class="muted">normal</span>
          <span class="dot" style="background:#10b981"></span><span class="muted">chosen</span>
          <span class="dot" style="background:#f59e0b"></span><span class="muted">viewed</span>
          <span class="dot" style="background:#ef4444"></span><span class="muted">dismissed</span>
        </div>
      </div>
      <div id="map"></div>
      <div class="muted" style="margin-top:8px">Click a pin for quick actions (Choose / View / Dismiss).</div>
    </div>
  </section>

  <!-- Planner -->
  <section id="planner-view" style="display:none">
    <div class="card">
      <div class="row" style="gap:12px">
        <div style="flex:1;min-width:180px">
          <label>Start time</label>
          <input type="time" id="p-start" value="08:30" />
        </div>
        <div style="flex:2;min-width:260px">
          <label>Start location</label>
          <input type="text" id="p-origin" value="Cunnamulla Fella Statue, Cunnamulla" />
        </div>
      </div>
      <div class="muted" style="margin-top:8px">Order is based on nearest neighbour with time windows; drive times are estimated.</div>
      <div id="route" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- Favourites -->
  <section id="favs-view" style="display:none">
    <div id="favs-list" class="list"></div>
  </section>
</main>

<footer>Prototype only. Data is sample. Invite, favourites and planner run locally.</footer>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
  // ===== helpers & state =====
  const $ = (s) => document.querySelector(s);
  const $$ = (s) => Array.from(document.querySelectorAll(s));
  const todayISO = new Date().toISOString().slice(0,10);

  function kmBetween(a,b){
    const R=6371, dLat=(b.lat-a.lat)*Math.PI/180, dLon=(b.lng-a.lng)*Math.PI/180;
    const la1=a.lat*Math.PI/180, la2=b.lat*Math.PI/180;
    const x=Math.sin(dLat/2)**2 + Math.cos(la1)*Math.cos(la2)*Math.sin(dLon/2)**2;
    return 2*R*Math.asin(Math.sqrt(x));
  }
  function minutes(hhmm){const [h,m]=hhmm.split(":").map(n=>parseInt(n,10));return h*60+m}
  function hhmm(mins){const h=Math.floor(mins/60)%24,m=mins%60;return String(h).padStart(2,"0")+":"+String(m).padStart(2,"0")}
  function formatDate(iso){const d=new Date(iso+"T00:00:00");return d.toLocaleDateString(undefined,{weekday:"short",day:"numeric",month:"short"})}
  function share(text,url){
    if(navigator.share){navigator.share({title:"Garage Sales",text,url}).catch(()=>{})}
    else{navigator.clipboard?.writeText(text+" "+url).catch(()=>{}); alert("Link copied to clipboard.");}
  }

  // Colored SVG marker icons (blue, green, orange, red)
  function pin(color){ return L.icon({
    iconUrl: `data:image/svg+xml;utf8,${encodeURIComponent(
      `<svg xmlns='http://www.w3.org/2000/svg' width='28' height='40' viewBox='0 0 28 40'>
         <path d='M14 0C6.82 0 1 5.82 1 13c0 9.5 13 27 13 27s13-17.5 13-27C27 5.82 21.18 0 14 0z' fill='${color}'/>
         <circle cx='14' cy='13' r='5' fill='white'/>
       </svg>` )}`,
    iconSize:[28,40], iconAnchor:[14,40], popupAnchor:[0,-36]
  })};
  const ICONS = {
    normal: pin("#2563eb"),   // blue
    chosen: pin("#10b981"),   // green
    viewed: pin("#f59e0b"),   // orange
    dismissed: pin("#ef4444") // red
  };

  // sample data
  function seed(){
    const d0=todayISO, d1=new Date(Date.now()+86400000).toISOString().slice(0,10);
    return [
      {id:"S1",title:"Family clear out with bikes and books",desc:"Kids bike 20 inch, pram, books, kitchenware, garden tools. Cash only.",
       addr:"22 Vanity Street, Toowoomba 4350", suburb:"Toowoomba", postcode:"4350", lat:-27.5667, lng:151.95,
       tags:["bike","books","tools","pram"], open:[{date:d0,start:"08:00",end:"12:00"},{date:d1,start:"09:00",end:"11:00"}]},
      {id:"S2",title:"Shed downsizing, tools and furniture",desc:"Hand tools, lawn gear, sofa, chairs, camping gear.",
       addr:"5 Mabel Street, Cunnamulla 4490", suburb:"Cunnamulla", postcode:"4490", lat:-28.0667, lng:145.6833,
       ta

