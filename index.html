<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Garage Sales – Toowoomba Prototype</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous"/>
<style>
  :root { --bg:#f7f7f8; --card:#ffffff; --ink:#111827; --muted:#6b7280; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  header{background:#fff;border-bottom:1px solid #e5e7eb}
  .wrap{max-width:1120px;margin:0 auto;padding:16px}
  h1{margin:0;font-size:20px}
  nav button{padding:8px 14px;border:0;border-radius:999px;background:#e5e7eb;cursor:pointer}
  nav button.active{background:#111827;color:#fff}
  .card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,.06);margin-top:12px}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:4px}
  input[type="text"],input[type="date"],input[type="time"]{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .legend{display:flex;gap:10px;align-items:center;margin-top:8px}
  .dot{width:10px;height:10px;border-radius:50%}
  footer{color:var(--muted);text-align:center;padding:24px}
  #map{height:520px;border-radius:16px;overflow:hidden}
  #err{display:none;position:fixed;left:10px;right:10px;bottom:10px;background:#fee2e2;color:#7f1d1d;padding:10px;border-radius:8px;font-size:13px;z-index:9999}
</style>
</head>
<body>
<header>
  <div class="wrap row" style="align-items:center;justify-content:space-between">
    <h1>Garage Sales</h1>
    <nav class="row">
      <button id="tab-search" class="active">Search</button>
      <button id="tab-map">Map</button>
    </nav>
  </div>
</header>

<main class="wrap">
  <section id="map-view">
    <div class="card">
      <div class="legend">
        <span class="dot" style="background:#2563eb"></span><span class="muted">new</span>
        <span class="dot" style="background:#10b981"></span><span class="muted">chosen</span>
        <span class="dot" style="background:#f59e0b"></span><span class="muted">viewed</span>
        <span class="dot" style="background:#ef4444"></span><span class="muted">dismissed</span>
      </div>
      <div id="map"></div>
    </div>
  </section>
</main>

<div id="err"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
<script>
/* error banner */
window.addEventListener('error', (e)=>{
  const box=document.getElementById('err');
  box.style.display='block';
  box.textContent='Error: '+(e.message||e.error);
});

function localISODate(date=new Date()){
  const tz=date.getTimezoneOffset()*60000;
  return new Date(date.getTime()-tz).toISOString().slice(0,10);
}
const todayISO=localISODate();

/* 10 demo Toowoomba sales across 30–31 Aug 2025 */
const D0="2025-08-30";
const D1="2025-08-31";
const SALES=[
 {id:"T1",title:"Rangeville family clear-out",addr:"12 South Street, Rangeville QLD 4350",lat:-27.58,lng:151.973,open:[{date:D0,start:"08:00",end:"12:00"},{date:D1,start:"08:00",end:"12:00"}]},
 {id:"T2",title:"Centenary Heights downsizing – furniture & tools",addr:"5 Southland Street, Centenary Heights QLD 4350",lat:-27.594,lng:151.966,open:[{date:D0,start:"09:00",end:"13:00"},{date:D1,start:"09:00",end:"13:00"}]},
 {id:"T3",title:"Newtown shed sale – retro, records",addr:"40 Holberton Street, Newtown QLD 4350",lat:-27.558,lng:151.93,open:[{date:D0,start:"08:30",end:"12:30"}]},
 {id:"T4",title:"Harristown moving sale – baby gear",addr:"18 Campbell Street, Harristown QLD 4350",lat:-27.586,lng:151.929,open:[{date:D1,start:"10:00",end:"14:00"}]},
 {id:"T5",title:"Kearneys Spring multi-house sale – camping",addr:"6 West Street, Kearneys Spring QLD 4350",lat:-27.603,lng:151.945,open:[{date:D0,start:"07:30",end:"11:30"}]},
 {id:"T6",title:"East Toowoomba – garden & kitchenware",addr:"98 Mary Street, East Toowoomba QLD 4350",lat:-27.563,lng:151.971,open:[{date:D1,start:"08:00",end:"12:00"}]},
 {id:"T7",title:"North Toowoomba – bikes & games",addr:"15 Jones Street, North Toowoomba QLD 4350",lat:-27.541,lng:151.946,open:[{date:D1,start:"09:30",end:"12:30"}]},
 {id:"T8",title:"Wilsonton – tools, mower, ladders",addr:"2 Erin Street, Wilsonton QLD 4350",lat:-27.54,lng:151.903,open:[{date:D0,start:"08:00",end:"12:00"}]},
 {id:"T9",title:"Mount Lofty – retro lamps & decor",addr:"7 Stuart Street, Mount Lofty QLD 4350",lat:-27.545,lng:151.963,open:[{date:D1,start:"10:00",end:"14:00"}]},
 {id:"T10",title:"South Toowoomba – pram, kids clothes",addr:"21 Long Street, South Toowoomba QLD 4350",lat:-27.575,lng:151.948,open:[{date:D0,start:"08:30",end:"12:30"}]}
];

const state={selected:[],viewed:[],dismissed:[]};
function statusOf(id){
  if(state.dismissed.includes(id)) return "dismissed";
  if(state.selected.includes(id)) return "chosen";
  if(state.viewed.includes(id)) return "viewed";
  return "new";
}

function pin(color){return L.icon({iconUrl:`data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='28' height='40'><path d='M14 0C6.82 0 1 5.82 1 13c0 9.5 13 27 13 27s13-17.5 13-27C27 5.82 21.18 0 14 0z' fill='${color}'/><circle cx='14' cy='13' r='5' fill='white'/></svg>`)}`,iconSize:[28,40],iconAnchor:[14,40],popupAnchor:[0,-36]});}
const ICONS={new:pin("#2563eb"),chosen:pin("#10b981"),viewed:pin("#f59e0b"),dismissed:pin("#ef4444")};

let map;
function initMap(){
  map=L.map('map').setView([-27.56,151.95],12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  SALES.forEach(s=>{
    if(s.open.some(o=>o.date===todayISO)){
      const st=statusOf(s.id);
      L.marker([s.lat,s.lng],{icon:ICONS[st]}).addTo(map).bindPopup(s.title+"<br/>"+s.addr);
    }
  });
}
initMap();
</script>
</body>
</html>

